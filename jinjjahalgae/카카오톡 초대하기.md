1. 📖 들어가며
이 포스팅은 Next.js 11 버전(page router) 환경에서 작성된 글입니다.13버전 이후 app router 환경에서 구현하는 방법은 이 포스팅에서 1 ~ 1-3까지만 보시고 여기를 참고해주세요.
 
Next.js + Typescript 환경에서 토이 프로젝트를 진행하던 중 카카오톡으로 공유하기 기능이 필요해서 구현을 했었는데, 몇몇 오류도 마주치고 따로 정리를 하면 좋을 것 같아서 이렇게 정리하게 됩니다.
1.1. 1. 애플리케이션 등록하기
일단 첫 번째로 개발하기에 앞서서 Kakao Developers
        
        
      에서 어플리케이션 등록을 해줘야 합니다.
1.1.1. 1-1 로그인
사이트에 접속 해주시고 첫 화면에서 로그인을 해주시고 '내 애플리케이션'을 클릭해주세요.
 
카카오 데브 첫화면


1.1.2. 1-2 애플리케이션 추가하기
그러면 이렇게 애플리케이션을 추가할 수 있는 화면이 나옵니다.
여기서 '애플리케이션 추가하기'를 눌러주세요.
내 애플리케이션


 
'애플리케이션 추가하기'를 클릭하면 이렇게 추가할 수 있는 모달 창이 나옵니다.
앱 이름에는 만들고자 하는 서비스 이름을 기재해주시고,
사업자명에는 사업자명이 없으면 본인 이름을 적어주셔도 괜찮습니다.
애플리케이션 추가하기


 
추가가 완료 되었으면 해당 추가한 애플리케이션의 요약정보에는 본인이 생성한 애플리케이션의 앱 키들이 존재합니다.
여기서 저희는 JavaScript 키를 사용할 것입니다.
요약 정보


1.1.3.  
1.1.4. 1-3 Web 플랫폼 등록
좌측 메뉴에서 플랫폼이라는 메뉴를 클릭해주시고 저희가 사용할 콘텐츠는 Web이니깐 'Web 플랫폼' 등록 버튼을 클릭해주시면 아래와 같은 화면이 나오는데, 여기서 저희가 개발환경에서 사용할 서버 주소와, 배포를 하셨으면 배포한 주소도 같이 적어주시면 됩니다.
Web플랫폼 등록


이제 카카오톡 공유기능을 구현할 준비단계는 끝났습니다.
1.2. 2. 적용
1.2.1. 2-1 JavaScript SDK 추가하기
이제 해당 기능을 사용하기 위해서는 SDK를 추가해 줘야 합니다.

      
      
      
    
    
      <javascript />
    
        
        
       <script defer src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
위와 같은 script 태그를 <head> 사이에 작성해 줘야 하는데,
next.js에서는 _documnet에서 공통적으로 사용할 <head> 또는 <body> 태그 등 안에 들어갈 내용들을 커스텀할 때 사용합니다. 이에 대한 자세한 내용은 공식문서를 참고해주세요.
https://nextjs.org/docs/advanced-features/custom-document
        
        
      

 

Advanced Features: Custom `Document` | Next.js
Extend the default document markup added by Next.js.
nextjs.org


그럼 카카오톡 공유 기능을 구현할 프로젝트에 구성을 해주도록 합시다.
'./pages/_document.tsx'

      
      
      
    
    
      <javascript />
    
        
        
      import Document, { Html, Head, Main, NextScript } from 'next/document';

class MyDocument extends Document {
  render() {
    return (
      <Html>
        <Head>
         <script
            defer
            src="https://developers.kakao.com/sdk/js/kakao.min.js"
          ></script>
        <Head/>
        <body>
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }
}

export default MyDocument;
1.2.2. 2-2 env
처음에  Kakao Developers에서 애플리케이션
        
        
       추가하고 요약 탭에서 봤던 JavaScript 키를 env파일로 작성해줍시다.
API Key는 코드에 직접 명시하는 것보다 보안상 env파일로 작성해 두는 것이 좋습니다.
루트 폴더에 .env 파일을 생성하고 아래와 같이 작성해주세요. 
(API 키를 작성할 때 ' ' 따옴표는 필요 없습니다.)
'.env'

      
      
      
    
    
      <javascript />
    
        
        
      NEXT_PUBLIC_KAKAO_API_KEY=API키
1.2.3. 2-3 initialize
이제 JavaScript 키를 이용해서 initialize를 해줘야 합니다.
initialize는 아래와 같이 해줄 수 있습니다.
상위 컴포넌트 (ex. Layout or _app)에서 마운트 될 때 적용될 수 있도록 해줍시다.
하나의 페이지에서만 공유 기능을 사용할 것이라면 사용할 페이지에서 작성해도 됩니다.
저는 여러 페이지에서 사용을 하기 위해서 상위 컴포넌트(Layout.tsx)에 작성해주었습니다.
ex)
'./src/components/common/Layout.tsx'

      
      
      
    
    
      <javascript />
    
        
        
      import GlobalStyle from 'styles/GlobalStyle';
import styled from 'styled-components';
import { size } from 'styles/theme';
import Footer from './Footer';
import DarkModeBtn from '../Buttons/DarkModeBtn';
import { useEffect } from 'react';

const Wrapper = styled.div`
  width: 100%;
  max-width: ${size.mobile};
  min-height: 100vh;
  margin: auto;
  padding: ${({ theme }) => theme.padding.base};
  display: flex;
  flex-direction: column;
  justify-content: center;
`;

interface IProps {
  children: React.ReactNode;
}

const Layout = ({ children }: IProps) => {
  useEffect(() => {
      window.Kakao.init(process.env.NEXT_PUBLIC_KAKAO_API_KEY);
  }, []);

  return (
    <Wrapper>
      <GlobalStyle />
      <DarkModeBtn />
      {children}
      <Footer />
    </Wrapper>
  );
};

export default Layout;
그리고 이렇게만 작성하게 되면 window 객체 안에 Kakao가 없다고 오류가 발생할 것입니다.
window 객체에 Kakao가 있다고 알려줘야 합니다.
전역으로 window interface를 정의해줍시다.
'./pages/_app.tsx'

      
      
      
    
    
      <javascript />
    
        
        
      import type { AppProps } from 'next/app';
import Layout from 'src/components/common/Layout';
import ThemeProvider from 'src/context/ThemeProvider';

declare global {
  interface Window {
    Kakao: any;
  }
}

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ThemeProvider>
      <Layout>
        <Component {...pageProps} />
      </Layout>
    </ThemeProvider>
  );
}
export default MyApp;
TypeScript에서 any 타입을 최대한 지향하는 것이 좋지만, Kakao의 type을 따로 알 수 없어서 any로 명시했습니다.
이렇게 명시를 해주면 오류가 발생하지 않고 window 객체의 Kakao에 접근이 가능합니다.
1.2.4. 2-4 onClick function
저는 카카오 공유 기능을 하는 버튼 컴포넌트를 따로 작성했습니다.

      
      
      
    
    
      <javascript />
    
        
        
      import Button from '../common/Button';
import styled from 'styled-components';
import KakaoIcon from 'public/images/kakaotalk_logo_icon_147272.svg';

const SButton = styled(Button)`
  display: flex;
  justify-content: center;
  align-items: center;
`;

const KakaoBtn = () => {
  const onClick = () => {
    const { Kakao, location } = window;
    Kakao.Link.sendScrap({
      requestUrl: location.href,
    });
  };
  return (
    <SButton fontColor="yellow" borderColor="whiteYellow" onClick={onClick}>
      <KakaoIcon viewBox="0 0 60 48" width="30px" height="23px" />
      카카오톡 공유하기
    </SButton>
  );
};

export default KakaoBtn;
버튼을 클릭했을 때 실행하는 onClick 함수에서 기능을 하는 코드를 작성해 주었습니다.
아래와 같은 부분은 requestUrl이 공유할 Url입니다.
location.href를 작성해 줌으로써 현재 위치해있는 URL을 공유할 수 있도록 했습니다.

      
      
      
    
    
      <javascript />
    
        
        
       Kakao.Link.sendScrap({
      requestUrl: location.href,
    });
그리고 중요한 부분은 카카오 공유 방식에 있어서 여러 가지 방법이 있습니다.
ex)
사용자 정의 템플릿


https://developers.kakao.com/docs/latest/ko/message/js-link
        
        
      

 

Kakao Developers
카카오 API를 활용하여 다양한 어플리케이션을 개발해보세요. 카카오 로그인, 메시지 보내기, 친구 API, 인공지능 API 등을 제공합니다.
developers.kakao.com


저는 SEO를 위해 페이지에 meta og tag를
        
        
       작성해서 공식문서(위에 링크)를 참고해서 스크랩한 웹 페이지 정보를 바탕으로 메시지 내용을 구성할 수 있도록 Kakao.Link.sendScrap 메서드를 사용했습니다.
위 링크를 참고해 보시면 직접 메세지 제목, 내용 등 구성할 수 있는 메서드도 있습니다.
저는 많은 것들 중 sendScrap를 사용한 것입니다.
그리고 만약 개발 환경(localhost) 환경에서 sendScrap를 통한 공유 기능을 테스트할 시 카카오에서 locahost:3000 주소를 스크랩할 수 없기 때문에 제목, 내용 등 제대로 표시가 되지 않는 게 정상입니다.
별다른 오류가 발생하지 않는다면 프로젝트를 배포한 주소에서 테스트를 해보시면 정상적으로 메시지 내용이 나타나는 걸 확인할 수 있습니다.
2. 📕 마무리
Next.js + TypeScript 환경에서 카카오톡으로 공유하기 기능을 구현하는 방법에 대해서 알아봤습니다.
혹시 이해가 안 되시거나 구현하는 데에 있어서 모르시는 부분이 있으시면 댓글 남겨주세요!
                    
        
  
    반응형
    
    
    (adsbygoogle = window.adsbygoogle || []).push({});
  

        






     (adsbygoogle = window.adsbygoogle || []).push({});


    if(window.observeAdsenseUnfilledState !== undefined){ observeAdsenseUnfilledState(); }




  window.ReactionButtonType = 'reaction';
window.ReactionApiUrl = '//yong-nyong.tistory.com/reaction';
window.ReactionReqBody = {
    entryId: 16
}
좋아요11공유하기
  URL 복사카카오톡 공유페이스북 공유엑스 공유
게시글 관리
  

구독하기💻용뇽 개발 노트💻
    
        
            저작자표시 비영리 변경금지 
        
        (새창열림)
    

  


        
          
            
            
              💻용뇽 개발 노트💻
              @용뇽
              
                포스팅이 좋았다면 "좋아요❤️" 또는 "구독👍🏻" 해주세요!
              
            
          
        
      
      
        #toc-container .number { display: none };
      
      
        
    1. 📖 들어가며
1.1. 1. 애플리케이션 등록하기
1.1.1. 1-1 로그인
1.1.2. 1-2 애플리케이션 추가하기
1.1.3.  
1.1.4. 1-3 Web 플랫폼 등록
1.2. 2. 적용
1.2.1. 2-1 JavaScript SDK 추가하기
1.2.2. 2-2 env
1.2.3. 2-3 initialize
1.2.4. 2-4 onClick function
2. 📕 마무리
    
      
    
    
      Nextjs, nextjs typescript 카카오톡 공유기능, nextjs 카카오톡 공유, nextjs 카카오톡 공유 버튼, nextjs 카카오톡 공유기능, react 카카오톡 공유, TypeScript, 카카오 링크 공유, 카카오톡 공유 기능, 카카오톡 공유버튼
    
    💻용뇽 개발 노트💻누구나 이해할 수 있도록 글을 작성하려고 노력합니다.구독하기
      
        
          
    

  
    
      
        
          
        Name
      
      
    
    
      
        
          
        Password
      
      
    
    
      
        
          
        Homepage
      
      
    
  
  
    
      
        
      Secret
    
    
  


  


  
    
      
    Submit
  



        
        
          
            
                          

            
                  
                    
                      
                    
                    
                      ms_
                      안녕하세요!
useEffect 빈 배열이 componentDidMount 와 같은 동작을 한다고 알고 있고, Mount된 순간에 useEffect 내부에서 window 를 체크할 수 있는 것으로 알고 있는데요, 
useEffect 빈 배열 안에서도 window 가 undefined 로 찍히나요 ? ? 이중 예외처리 하신 것이 궁금하여 댓글 남겨봅니다
                      
                          
                            
                            
                          Reply to
                          
                            
                            
                          Edit/Delete
                          
                            
                          2021.12.03 15:18 신고
                    
                  
                  
                    
                      
                        
                          
                            
                              
                            
                            
                              용뇽
                              제가 당시에 오류가 나서 저렇게 예외처리를 했던 것으로 기억하는데, 지금 확인해 보니 예외처리를 따로 안 해도 될 것 같습니다 ㅎㅎ.. 저도 당시 의아했던 걸로 기억 하는데 정신이 없었던 것 같네요 ㅠㅠ 댓글 감사합니다! 덕분에 수정 했습니다 
                              
                                  
                                    
                                    
                                  Edit/Delete
                                  
                                    
                                  2021.12.06 22:53 신고
                            
                          
                        
                      
                    
                  
                
                  
                    
                      
                    
                    
                      otterji
                      정말 감사합니다
                      
                          
                            
                            
                          Reply to
                          
                            
                            
                          Edit/Delete
                          
                            
                          2022.04.04 15:36 신고
                    
                  
                  
                    
                      
                        
                          
                            
                              
                            
                            
                              용뇽
                              감사합니다^^
                              
                                  
                                    
                                    
                                  Edit/Delete
                                  
                                    
                                  2022.04.05 22:50 신고
                            
                          
                        
                      
                    
                  
                
                  
                    
                      
                    
                    
                      팡스
                      안녕하세요. 지나가던 개발자입니다.글 잘 참고하였습니다.한가지 알아두셔야 할 사항이 있어 댓글 남겨둡니다.env파일을 보안상의 이유로 쓰는 것은 맞으나, 그것은 서버사이드에서만 사용했을때 유효한 사항입니다.NEXT_PUBLIC_ 형태로 할당하여 클라에서 사용하면 결국 코드상에 모두 노출되기 때문에 말씀하신 보안은 해당이 없어집니다.저도 혹시나 Next.js 팀에서 별도 처리를 해놓았을까 싶어 빌드까지 해서 테스트해보았지만, 크롬 개발자도구에서 API키 원형 그대로 확인이 가능하네요.카카오API야 보통 저렇게 많이 쓰지만 혹시나 차후 다른 중요한 키값도 클라쪽에서 사용하실까 염려되어 댓글 남기고 갑니다.
                      
                          
                            
                            
                          Reply to
                          
                            
                            
                          Edit/Delete
                          
                            
                          2022.11.03 15:56 신고
                    
                  
                  
                    
                      
                        
                          
                            
                              
                            
                            
                              용뇽
                              좋은 정보 감사합니다^^
                              
                                  
                                    
                                    
                                  Edit/Delete
                                  
                                    
                                  2022.11.04 10:56 신고
출처: https://yong-nyong.tistory.com/16 [💻용뇽 개발 노트💻:티스토리]



---



          
          
          
            
              
                
              Published 2023. 12. 27. 15:50
            [Next.js] v13 이후 app router에서 카카오톡 공유하기 구현(feat.TypeScript)
              
                
                
              프로그래밍/Next.js
            
              
            
          
        
        
                    
        
  
    반응형
    
    
    (adsbygoogle = window.adsbygoogle || []).push({});
  

        

            [Next.js] v13 이후 app router에서 카카오톡 공유하기 구현(feat.TypeScript)


1. 📖 들어가며
최근 Next.14 버전 app router로 마이그레이션을 진행하면서 카카오톡 공유하기 기능을 구현하는 데 있어서 변경된 부분과 여러 오류를 맞이하여 새롭게 포스팅합니다.
 
이전 포스팅
        
        
      에서 1번 ~ 1-3번까지는 방법이 동일합니다.
이전 포스팅을 참고해서 플랫폼 등록까지 하고 읽어주시면 감사하겠습니다.
 
app router에서는 _document.tsx와 _app.tsx가 사라지고 이전에 해당 파일에서 작성되었던 코드는 layout.tsx에서 작성해주어야 합니다.
2. 스크립트 컴포넌트 작성
카카오 디벨로퍼에서 플랫폼 등록을 완료했다면 이제 프로젝트로 돌아와서 적용을 해봅시다.
 
먼저 KakaoScript.tsx 파일을 생성하고 아래 코드를 생성합니다.
파일 위치는 프로젝트 구조에 맞게 생성하시면 됩니다.

      
      
      
    
    
      <typescript />
    
        
        
      // KakaoScript.tsx

'use client';

import Script from 'next/script';

function KakaoScript() {
  const onLoad = () => {
    window.Kakao.init(process.env.NEXT_PUBLIC_KAKAO_API_KEY);
  };

  return (
    <Script
      src="https://developers.kakao.com/sdk/js/kakao.js"
      async
      onLoad={onLoad}
    />
  );
}

export default KakaoScript;
이전(v11) page router에서는 최상단 컴포넌트에서 useEffect를 사용하여 Kakao.init을 진행했지만,
TypeScript 환경의 app router 에서는 해당 방법으로 동작하지 않고 Kakao.init이 제대로 실행되지 않는 문제를 겪었습니다.
 
함수를 사용하는 부분이 있기 때문에 'use clinet' 문법을 사용하여 해당 컴포넌트는 클라이언트 컴포넌트 사실을 알려줍니다.
 
next에서 제공하는 Script를 사용해서 적용시키는 방법입니다.
 
먼저,
Kakao Developers
        
        
      에서 애플리케이션 요약 탭에서 JavaScript 키를 env파일로 작성합니다.
다음으로,
Script의 src에 카카오 sdk를 넣어줍니다.
여기서 중요한 부분이 스크립트를 다 불러오는 즉시 실행할 수 있도록 하는 onLoad를 사용하여 Kakao.init을 적용시켜 줍니다.
 
이렇게 하게 되면 sdk를 성공적으로 불러오면 그 즉시 onLoad 함수를 실행하게 됩니다.
3. 스크립트 컴포넌트 적용

      
      
      
    
    
      <typescript />
    
        
        
      // layout.tsx

import KakaoScript from 'components/common/KakaoScript';

declare global {
  interface Window {
    Kakao: any;
  }
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
   return (
    <html>
      <body>
        <ClientComponentContainer>{children}</ClientComponentContainer>
      </body>
      <KakaoScript />
    </html>
  );
}
body 하단에 KakaScript 컴포넌트를 적용시켜 줍니다.
4. 공유하기 기능 구현
이전 게시글 코드에서는 Kakao.Link를 사용했었지만 sdk도 업데이트되면서 Kakao.Share를 통해 구현했습니다.
Link -> Share 외에 달라진 점은 없는 것 같습니다.
변경점

자세한 변경 사항


 

      
      
      
    
    
      <typescript />
    
        
        
      const handleShearToKakao = () => {
    const { Kakao, location } = window;
    Kakao.Share.sendScrap({
      requestUrl: location.href,
    });
  };
위와 같이 구현할 수 있습니다.
해당 함수를 공유하기 버튼에 적용하면 현재 경로를 기반해서 og tag를 참조하여 카카오톡으로 공유를 하게 됩니다.
4.1. 다른 옵션
이전 게시글 중 발췌


og tag를 이용한 sendScript 메서드를 이용하지 않아도 직접 작성하여 내용을 만들 수 있으니 공식문서
        
        
      를 참고하시면 됩니다!
5. 📕 마무리
app router 관련해서 자료가 너무 없었기 때문에 은근히 애를 먹었던 작업이었습니다,,
도움이 되셨으면 좋겠습니다.
출처: https://yong-nyong.tistory.com/85 [💻용뇽 개발 노트💻:티스토리]
